# GitHub Copilot 应用合法性审查指南

## 审查目标
指导GitHub Copilot自动审查开发者提交到2FStore的应用合法性，确保应用符合仓库规范和安全要求。

## 审查范围
1. **2FStore应用提交**：使用`app-submission`标签的Issue
2. **FnDepot应用提交**：使用`fnpack-submission`标签的Issue
3. **PR验证**：修改`apps.json`或`fnpacks.json`的Pull Request

## 审查标准

### 1. 2FStore应用审查标准

#### 1.1 应用基本信息验证
- [ ] 应用ID唯一且符合格式要求（仅小写字母、数字、符号"-"）
- [ ] 应用名称不能为空且具有描述性
- [ ] GitHub仓库URL有效且可访问

#### 1.2 仓库结构验证
- [ ] 仓库根目录包含`manifest`文件
- [ ] 仓库根目录包含`ICON.PNG`文件（256x256，全大写）
- [ ] 至少有一个Release版本包含有效的`.fpk`下载文件

#### 1.3 Manifest文件验证
验证`manifest`文件是否包含以下必要字段且格式正确：
- [ ] `appname`：应用名称
- [ ] `version`：版本号（语义化版本格式）
- [ ] `display_name`：显示名称
- [ ] `desc`：应用描述

#### 1.4 内容合法性验证
- [ ] 应用不包含违法、侵权内容
- [ ] 应用不包含恶意代码或安全漏洞
- [ ] 应用描述真实准确，不包含虚假信息

### 2. FnDepot应用审查标准

#### 2.1 仓库信息验证
- [ ] GitHub仓库URL有效且可访问
- [ ] 仓库名称必须为`FnDepot`
- [ ] 仓库包含`fnpack.json`文件

#### 2.2 仓库结构验证
- [ ] 仓库根目录包含`fnpack.json`文件
- [ ] 每个应用都有独立的目录，目录名即为`app_key`
- [ ] 每个应用目录包含：
  - `ICON.PNG`（256x256，全大写）
  - `{app_name}.fpk`安装包 (可选，详见 2.4 安装包(.fpk)要求)
  - `README.md`文档
  - `Preview/`预览图目录（可选）

#### 2.3 fnpack.json验证
验证`fnpack.json`文件是否包含以下必要字段：
- [ ] `display_name`：应用显示名称
- [ ] `version`：版本号
- [ ] `desc`：应用描述
- [ ] `download_url`：（如有,详见 2.4 安装包(.fpk)要求）必须指向有效的安装包下载地址

#### 2.4 安装包(.fpk)要求
- [ ] 安装包格式必须为FNOS标准安装包格式(.fpk)
- [ ] 安装包路径符合以下模式之一：
  - **模式1**（适用于小于100MB的安装包）：`/{app_name}/{app_name}.fpk`
  - **模式2**：通过GitHub Release发布
- [ ] 文件名必须严格匹配`{app_name}.fpk`格式
- [ ] 如提供`download_url`，必须指向有效的安装包下载地址

#### 2.5 内容合法性验证
与2FStore应用相同的内容合法性要求。

## 审查流程

### 1. Issue处理流程
1. **自动分类**：根据Issue标签识别应用类型（app-submission或fnpack-submission）
2. **信息提取**：从Issue表单中提取应用信息
3. **仓库检查**：验证GitHub仓库的有效性和结构完整性
4. **元数据验证**：检查manifest或fnpack.json文件的完整性
5. **安装包验证**：确认Release版本包含有效的安装包
6. **合法性审查**：检查应用内容是否合法合规
7. **结果反馈**：在Issue中回复审查结果

### 2. PR验证流程
1. **文件检查**：验证修改的`apps.json`或`fnpacks.json`文件
2. **唯一性检查**：确保应用ID/key不存在重复
3. **格式验证**：检查JSON格式是否正确
4. **元数据完整性**：确保所有必要字段都已填写
5. **一致性检查**：验证应用信息与仓库实际内容一致

## 常见问题及解决方案

### 1. 应用ID重复
- **问题**：开发者提交的应用ID已存在
- **解决方案**：要求开发者修改应用ID为唯一值

### 2. 缺少必要文件
- **问题**：仓库缺少manifest文件或ICON.PNG
- **解决方案**：指导开发者按照规范添加缺少的文件

### 3. manifest格式错误
- **问题**：manifest文件字段缺失或格式不正确
- **解决方案**：提供正确的manifest示例，要求开发者修正

### 4. 安装包无效
- **问题**：Release中没有有效的.fpk文件
- **解决方案**：指导开发者创建包含安装包的Release版本

## 审查决策指南

### 通过审查的条件
- 所有必要字段都已正确填写
- 仓库结构完整符合规范
- 应用内容合法合规
- 没有发现安全风险

### 需要人工干预的情况
- 应用内容存在争议
- 审查规则不明确的特殊情况
- 自动化审查失败但可能存在误判

### 拒绝审查的情况
- 应用包含违法内容
- 应用包含恶意代码
- 开发者多次提交不符合规范的应用
- 仓库存在明显的安全漏洞

## 工具使用指导

### GitHub API调用
- 使用GitHub API获取Issue和PR信息
- 使用GitHub API检查仓库结构和文件内容
- 使用GitHub API验证Release和安装包

### 验证脚本调用
- 使用`scripts/validate_pr.py`验证PR提交
- 使用`scripts/process_app_issue.py`处理应用提交
- 使用`scripts/process_fnpack_issue.py`处理FnDepot应用提交

## 审查结果反馈模板

### 审查通过
```
✅ 应用审查通过！

您的应用已成功通过合法性审查，将很快添加到2FStore仓库中。

审查结果：
- 应用ID：{app_id}
- 应用名称：{app_name}
- 仓库URL：{repo_url}
- 审查时间：{time}
```

### 审查需要修正
```
⚠️ 应用审查需要修正

您的应用提交需要进行以下修正：

1. {问题1}
2. {问题2}
3. {问题3}

请按照2FStore应用提交规范修正后重新提交。
```

### 审查失败
```
❌ 应用审查失败

您的应用提交未能通过合法性审查，原因如下：

{具体失败原因}

如果您有疑问，请在Issue中回复说明。
```